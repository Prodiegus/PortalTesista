FROM quay.io/keycloak/keycloak:24.0.0

WORKDIR /opt/keycloak

EXPOSE 8443

ARG KEYCLOAK_USER
ARG KEYCLOAK_PASSWORD
ARG KC_BOOTSTRAP_ADMIN_USERNAME
ARG KC_BOOTSTRAP_ADMIN_PASSWORD
ARG DB_VENDOR
ARG DB_ADDR
ARG DB_DATABASE
ARG DB_USER
ARG DB_PASSWORD

ENV KEYCLOAK_USER=${KEYCLOAK_USER}
ENV KEYCLOAK_PASSWORD=${KEYCLOAK_PASSWORD}

ENV KC_BOOTSTRAP_ADMIN_USERNAME=${KC_BOOTSTRAP_ADMIN_USERNAME}
ENV KC_BOOTSTRAP_ADMIN_PASSWORD=${KC_BOOTSTRAP_ADMIN_PASSWORD}
ENV DB_VENDOR=${DB_VENDOR}
ENV DB_ADDR=${DB_ADDR}
ENV DB_DATABASE=${DB_DATABASE}
ENV DB_USER=${DB_USER}
ENV DB_PASSWORD=${DB_PASSWORD}

ARG PORTALTESISTA_THEME_BASE_DIR=/opt/keycloak/themes/PortalTesista
ARG PORTALTESISTA_THEME_LOCAL_ROOT_DIR=themes/PortalTesista

RUN mkdir ${PORTALTESISTA_THEME_BASE_DIR}

COPY ${PORTALTESISTA_THEME_LOCAL_ROOT_DIR} ${PORTALTESISTA_THEME_BASE_DIR}

COPY certs/selfsigned.jks /etc/ssl/certs/selfsigned.jks

ENTRYPOINT ["./bin/kc.sh", "start-dev", "--https-port=8443", "--https-key-store-file=/etc/ssl/certs/selfsigned.jks", "--https-key-store-password=changeit"]